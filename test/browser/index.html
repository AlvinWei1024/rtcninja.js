<!DOCTYPE html>
<html>

<head>
	<title>rtcninja.js</title>
	<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
	<script src='Temasys-adapter.js'></script>
	<script src='rtcninja.js'></script>
	<script src='Peer.js'></script>
	<script>
		// rtcninja.debug.enable('rtcninja*');
		rtcninja.debug.enable('*');
	</script>

	<script>
	function test() {
		var debug = rtcninja.debug('index.html');
		var peerA, peerB;
		var localStream = null;

		rtcninja.getUserMedia(
			{audio:true, video:true},
			function(stream) {
				localStream = stream;
				startTheParty();
			},
			function(error) {
				console.error('index.html getUserMedia() failed:', error);
			}
		);

		function closeAll() {
			if (peerA) { peerA.close(); }
			if (peerB) { peerB.close(); }
			if (localStream) { rtcninja.Utils.closeMediaStream(localStream); }
		}

		function startTheParty() {
			debug('startTheParty()');

			var configuration = {
				iceServers: [{
					// urls: [
					// 	'turn:turn.ef2f.com:3478?transport=udp',
					// 	'turn:turn.ef2f.com:3478?transport=tcp',
					// 	'turns:turn.ef2f.com:443?transport=tcp'
					// ],
					urls: 'turn:turn.ef2f.com:3478?transport=udp',
					username: 'turn',
					credential: 'ef2f'
				}],
				iceTransports: 'relay',
				gatheringTimeoutAfterRelay: 500
			};

			peerA = new Peer('A', localStream, configuration);
			peerB = new Peer('B', localStream, configuration);

			peerA.onIceCandidate = function(candidate) {
				if (! candidate) { return; }
				peerB.addIceCandidate(candidate);
			};

			peerB.onIceCandidate = function(candidate) {
				if (! candidate) { return; }
				peerA.addIceCandidate(candidate);
			};

			peerA.call(function(offer) {
				peerB.answer(offer, function(answer) {
					peerA.setRemoteDescription(answer);
				});
			});
		}
	}
	</script>
</head>

<body onload='test()'></body>

</html>
